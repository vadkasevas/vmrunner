"use strict";var _interopRequireDefault3 = require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireDefault2 = _interopRequireDefault3(require("@babel/runtime/helpers/interopRequireDefault"));Object.defineProperty(exports, "__esModule", { value: true });var _typeof2 = require("@babel/runtime/helpers/typeof");var _typeof = (0, _interopRequireDefault2["default"])(_typeof2)["default"];exports.





































getLogFunction = getLogFunction;exports.











































































































































handleLabeledStatement = handleLabeledStatement;exports["default"] =





























































































































































































































function (babel) {
  return {
    visitor: {
      Program: function Program(program, _ref3) {var opts = _ref3.opts;
        program.traverse({
          LabeledStatement: function LabeledStatement(path) {
            handleLabeledStatement(babel, path, opts);
          } });


        if (!program.vmRunnerWrapper) {
          program.vmRunnerWrapper = true;
          var wrapped = wrapVmRunner({
            BODY: program.node.body,
            VM_RUNNER_RUN_ID: babel.types.identifier('VM_RUNNER_RUN_ID'),
            VM_RUNNER_HASH: babel.types.identifier('VM_RUNNER_HASH'),
            VM_RUNNER_TRACE: babel.types.identifier('VM_RUNNER_TRACE') });


          program.replaceWith(
          babel.types.program(wrapped));

        }
        program.node.directives = [];

      } } };


};var _path = require("path");var fspath = (0, _interopRequireDefault2["default"])(_path)["default"];var _underscore = require("underscore");var _ = (0, _interopRequireDefault2["default"])(_underscore)["default"];var _template = require("@babel/template");var template = (0, _interopRequireDefault2["default"])(_template)["default"];var _lodash = require("lodash");var get = _lodash.get;var $handled = Symbol('handled');var $normalized = Symbol('normalized');var PRESERVE_CONTEXTS = normalizeEnv(process.env.TRACE_CONTEXT);var PRESERVE_FILES = normalizeEnv(process.env.TRACE_FILE);var PRESERVE_LEVELS = normalizeEnv(process.env.TRACE_LEVEL); /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * Normalize an environment variable, used to override plugin options.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   */function normalizeEnv(input) {if (!input) {return [];}return input.split(',').map(function (context) {return context.toLowerCase().trim();}).filter(function (id) {return id;});} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        * Like `template()` but returns an expression, not an expression statement.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        */function expression(input, template) {var fn = template(input);return function (ids) {var node = fn(ids);return node.expression ? node.expression : node;};} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        * The default log() function.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        */function getLogFunction(_ref, logLevel) {var t = _ref.types,template = _ref.template;return function log(message, metadata) {var messageExpression = message.messageExpression;var prefix = "".concat(metadata.context, ":");if (metadata.indent) {prefix += new Array(metadata.indent + 1).join('  ');}if (t.isSequenceExpression(message.content)) {return t.callExpression(t.memberExpression(t.identifier('console'), t.identifier(logLevel)), [t.stringLiteral(prefix)].concat(message.content.expressions));} else {var LINE = metadata.path.node.loc.start.line;return expression("VM_RUNNER_TRACE.apply({line:LINE},[LOGLEVEL, PREFIX, MESSAGE,  DATA])", template)({ LOGLEVEL: t.stringLiteral(logLevel), PREFIX: t.stringLiteral(prefix), DATA: message.content, LINE: t.numericLiteral(LINE), VM_RUNNER_TRACE: t.identifier('VM_RUNNER_TRACE'), MESSAGE: messageExpression });}};}function generatePrefix(dirname, basename) {if (basename !== 'index') {return basename;}basename = fspath.basename(dirname);if (basename !== 'src' && basename !== 'lib') {return basename;}return fspath.basename(fspath.dirname(dirname));} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Collect the metadata for a given node path, which will be
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * made available to logging functions.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */function collectMetadata(path, opts) {var filename = fspath.resolve(process.cwd(), path.hub.file.opts.filename);var dirname = fspath.dirname(filename);var extname = fspath.extname(filename);var basename = fspath.basename(filename, extname);var prefix = generatePrefix(dirname, basename);var names = [];var indent = 0;var parent;var parentName = path.getAncestry().slice(1).reduce(function (parts, item) {if (item.isClassMethod()) {if (!parent) {parent = item;}parts.unshift(item.node.key.type === 'Identifier' ? item.node.key.name : '[computed method]');} else if (item.isClassDeclaration()) {if (!parent) {parent = item;}parts.unshift(item.node.id ? item.node.id.name : "[anonymous class@".concat(item.node.loc.start.line, "]"));} else if (item.isFunction()) {if (!parent) {parent = item;}parts.unshift(item.node.id && item.node.id.name || "[anonymous@".concat(item.node.loc.start.line, "]"));} else if (item.isProgram()) {if (!parent) {parent = item;}} else if (!parent && !item.isClassBody() && !item.isBlockStatement()) {indent++;}return parts;}, []).join(':');var hasStartMessage = false;var isStartMessage = false;if (parent && !parent.isProgram()) {var _iteratorNormalCompletion = true;var _didIteratorError = false;var _iteratorError = undefined;try {for (var _iterator = parent.get('body').get('body')[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {var child = _step.value;if (child.node[$handled]) {hasStartMessage = true;break;}if (!child.isLabeledStatement()) {break;}var label = child.get('label');if (opts.aliases[label.node.name]) {hasStartMessage = true;if (child.node === path.node) {isStartMessage = true;}break;}}} catch (err) {_didIteratorError = true;_iteratorError = err;} finally {try {if (!_iteratorNormalCompletion && _iterator["return"] != null) {_iterator["return"]();}} finally {if (_didIteratorError) {throw _iteratorError;}}}}var context = "".concat(prefix, ":").concat(parentName);return { indent: indent, prefix: prefix, parentName: parentName, context: context, hasStartMessage: hasStartMessage, isStartMessage: isStartMessage, filename: filename, dirname: dirname, basename: basename, extname: extname, path: path };} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Determine whether the given logging statement should be stripped.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */function shouldStrip(name, metadata, _ref2) {var strip = _ref2.strip;switch (_typeof(strip)) {case 'boolean':if (!strip) return false; // strip === true
      break;case 'object':var se = strip[name];if (!se || _typeof(se) === 'object' && !se[process.env.NODE_ENV]) return false; // strip[name] === true || strip[name][env] === true
      break;default:return false;}if (PRESERVE_CONTEXTS.length) {var context = metadata.context.toLowerCase();if (PRESERVE_CONTEXTS.some(function (pc) {return context.includes(pc);})) return false;}if (PRESERVE_FILES.length) {var filename = metadata.filename.toLowerCase();if (PRESERVE_FILES.some(function (pf) {return filename.includes(pf);})) return false;}if (PRESERVE_LEVELS.length) {var level = name.toLowerCase();if (PRESERVE_LEVELS.some(function (pl) {return level === pl;})) return false;}return true;}function handleLabeledStatement(babel, path, opts) {var t = babel.types;var label = path.get('label');opts = function normalizeOpts(babel, opts) {if (opts[$normalized]) {return opts;}if (!opts.aliases) {opts.aliases = { log: getLogFunction(babel, 'log'), trace: getLogFunction(babel, 'trace'), warn: getLogFunction(babel, 'warn'), error: getLogFunction(babel, 'error'), debug: getLogFunction(babel, 'debug') };} else {Object.keys(opts.aliases).forEach(function (key) {if (typeof opts.aliases[key] === 'string' && opts.aliases[key]) {var expr = expression(opts.aliases[key], babel.template);opts.aliases[key] = function (message) {return expr(message);};}});}if (opts.strip === undefined) {opts.strip = { log: { production: true }, trace: false, warn: { production: true } };}opts[$normalized] = true;return opts;}(babel, opts);var labelName = label.node.name;var variables = [];var methodPath = get(path, 'parentPath.parentPath', null);if (methodPath && ['ClassMethod', 'ObjectMethod'].indexOf(methodPath.type) > -1 && !methodPath.node["static"]) {variables.push('this');}_.each(path.scope.bindings, function (val, key) {if (variables.indexOf(key) == -1) variables.push(key);});var alias = opts.aliases[labelName];if (!alias) {return;}var metadata = collectMetadata(path, opts);if (shouldStrip(label.node.name, metadata, opts)) {path.remove();return;}path.traverse({ "EmptyStatement": function EmptyStatement(emptyStatement) {var properties = _.map(variables, function (varName) {var key = t.Identifier(varName);var value;if (varName != 'this') {value = t.Identifier(varName);} else {value = t.thisExpression();}return t.objectProperty(key, value, false);});var replacement = t.objectExpression(properties);replacement[$handled] = true;emptyStatement.replaceWith(replacement);}, /*"TemplateLiteral|StringLiteral"(item){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  },*/"VariableDeclaration|Function|AssignmentExpression|UpdateExpression|YieldExpression|ReturnStatement": function VariableDeclarationFunctionAssignmentExpressionUpdateExpressionYieldExpressionReturnStatement(item) {throw path.buildCodeFrameError("Logging statements cannot have side effects. ".concat(item.type));}, ExpressionStatement: function ExpressionStatement(statement) {if (statement.node[$handled]) {return;}var targetNode = statement.get('expression').node;var messageElements = [];if (targetNode.type === 'SequenceExpression') {var properties = _.chain(targetNode.expressions).map(function (expressionNode) {if (['Identifier', 'ThisExpression'].indexOf(expressionNode.type) > -1) {var varName = expressionNode.type === 'Identifier' ? expressionNode.name : 'this';var key = t.Identifier(varName);var value;if (expressionNode.type === 'Identifier') {value = t.Identifier(varName);} else {value = t.thisExpression();}return t.objectProperty(key, value, false);} else if (['StringLiteral', 'TemplateLiteral'].indexOf(expressionNode.type) > -1) {messageElements.push(expressionNode);}}).compact().value();if (_.isEmpty(properties) && !_.isEmpty(messageElements)) {var _properties = _.map(variables, function (varName) {var key = t.Identifier(varName);var value;if (varName != 'this') {value = t.Identifier(varName);} else {value = t.thisExpression();}return t.objectProperty(key, value, false);});targetNode = t.objectExpression(_properties);} else targetNode = t.objectExpression(properties);} else if (['TemplateLiteral', 'StringLiteral'].indexOf(targetNode.type) > -1) {messageElements.push(targetNode);var _properties2 = _.map(variables, function (varName) {var key = t.Identifier(varName);var value;if (varName != 'this') {value = t.Identifier(varName);} else {value = t.thisExpression();}return t.objectProperty(key, value, false);});targetNode = t.objectExpression(_properties2);}var messageExpression = t.callExpression(t.memberExpression(t.arrayExpression(messageElements), //object
      t.identifier('join'), //property
      false //computed
      ), [t.stringLiteral(' ')]);var message = { messageExpression: messageExpression, prefix: t.stringLiteral(metadata.prefix), content: targetNode, hasStartMessage: t.booleanLiteral(metadata.hasStartMessage), isStartMessage: t.booleanLiteral(metadata.isStartMessage), indent: t.numericLiteral(metadata.indent), parentName: t.stringLiteral(metadata.parentName), filename: t.stringLiteral(metadata.filename), dirname: t.stringLiteral(metadata.dirname), basename: t.stringLiteral(metadata.basename), extname: t.stringLiteral(metadata.extname) };var replacement = t.expressionStatement(alias(message, metadata));replacement[$handled] = true;statement.replaceWith(replacement);} });if (path.node) {if (path.get('body').isBlockStatement()) {path.replaceWithMultiple(path.get('body').node.body);} else {path.replaceWith(path.get('body').node);}}}var wrapVmRunner = template("\nvar VM_RUNNER_RUN_ID = '';\n\nfunction generateUid(){\n    var u='',i=0; var four = 4;\n    var pattern = 'xxxxxxxx-xxxx-'+four+'xxx-yxxx-xxxxxxxxxxxx';\n    while(i++<36) {\n        var c=pattern[i-1],\n        r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);\n        u+=(c=='-'||c==four)?c:v.toString(16)\n    }\n    return u;\n} \n\nif( typeof(vm2Options)==='undefined' ){\n  vm2Options = {};\n}\nvar VM_RUNNER_HASH = vm2Options.VM_RUNNER_HASH;\n\nvar customOptions = vm2Options.customOptions || {};\nvar traceOptions = customOptions.trace||{};\n\nvar VM_RUNNER_TRACE = function(logLevel,prefix,message,data){\n    var alias = traceOptions && traceOptions.aliases && traceOptions.aliases[logLevel] ;\n    var expression = (typeof vm2Options )!=='undefined' ? vm2Options.expression : null;\n    var messageObj = {\n        frame:vmCodeFrame(expression,this.line),\n        prefix:prefix,\n        message:message,\n        logLevel:logLevel,\n        data:data,\n        line:this.line,\n        date:new Date()\n    }\n    if( alias ){\n        try{\n            return alias.apply(this,[messageObj]);\n        }catch(e){\n            console.error(e);\n        }\n    }\n};\n\n\n\nreturn (function vmRunnerWrapper() {\n    VM_RUNNER_RUN_ID = generateUid();\n    \n    BODY;\n}).apply(this);\n");
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9iYWJlbC1wbHVnaW4uanMiXSwibmFtZXMiOlsiZ2V0TG9nRnVuY3Rpb24iLCJoYW5kbGVMYWJlbGVkU3RhdGVtZW50IiwiYmFiZWwiLCJ2aXNpdG9yIiwiUHJvZ3JhbSIsInByb2dyYW0iLCJvcHRzIiwidHJhdmVyc2UiLCJMYWJlbGVkU3RhdGVtZW50IiwicGF0aCIsInZtUnVubmVyV3JhcHBlciIsIndyYXBwZWQiLCJ3cmFwVm1SdW5uZXIiLCJCT0RZIiwibm9kZSIsImJvZHkiLCJWTV9SVU5ORVJfUlVOX0lEIiwidHlwZXMiLCJpZGVudGlmaWVyIiwiVk1fUlVOTkVSX0hBU0giLCJWTV9SVU5ORVJfVFJBQ0UiLCJyZXBsYWNlV2l0aCIsImRpcmVjdGl2ZXMiLCJmc3BhdGgiLCJfIiwidGVtcGxhdGUiLCJnZXQiLCIkaGFuZGxlZCIsIlN5bWJvbCIsIiRub3JtYWxpemVkIiwiUFJFU0VSVkVfQ09OVEVYVFMiLCJub3JtYWxpemVFbnYiLCJwcm9jZXNzIiwiZW52IiwiVFJBQ0VfQ09OVEVYVCIsIlBSRVNFUlZFX0ZJTEVTIiwiVFJBQ0VfRklMRSIsIlBSRVNFUlZFX0xFVkVMUyIsIlRSQUNFX0xFVkVMIiwiaW5wdXQiLCJzcGxpdCIsIm1hcCIsImNvbnRleHQiLCJ0b0xvd2VyQ2FzZSIsInRyaW0iLCJmaWx0ZXIiLCJpZCIsImV4cHJlc3Npb24iLCJmbiIsImlkcyIsImxvZ0xldmVsIiwidCIsImxvZyIsIm1lc3NhZ2UiLCJtZXRhZGF0YSIsIm1lc3NhZ2VFeHByZXNzaW9uIiwicHJlZml4IiwiaW5kZW50IiwiQXJyYXkiLCJqb2luIiwiaXNTZXF1ZW5jZUV4cHJlc3Npb24iLCJjb250ZW50IiwiY2FsbEV4cHJlc3Npb24iLCJtZW1iZXJFeHByZXNzaW9uIiwic3RyaW5nTGl0ZXJhbCIsImNvbmNhdCIsImV4cHJlc3Npb25zIiwiTElORSIsImxvYyIsInN0YXJ0IiwibGluZSIsIkxPR0xFVkVMIiwiUFJFRklYIiwiREFUQSIsIm51bWVyaWNMaXRlcmFsIiwiTUVTU0FHRSIsImdlbmVyYXRlUHJlZml4IiwiZGlybmFtZSIsImJhc2VuYW1lIiwiY29sbGVjdE1ldGFkYXRhIiwiZmlsZW5hbWUiLCJyZXNvbHZlIiwiY3dkIiwiaHViIiwiZmlsZSIsImV4dG5hbWUiLCJuYW1lcyIsInBhcmVudCIsInBhcmVudE5hbWUiLCJnZXRBbmNlc3RyeSIsInNsaWNlIiwicmVkdWNlIiwicGFydHMiLCJpdGVtIiwiaXNDbGFzc01ldGhvZCIsInVuc2hpZnQiLCJrZXkiLCJ0eXBlIiwibmFtZSIsImlzQ2xhc3NEZWNsYXJhdGlvbiIsImlzRnVuY3Rpb24iLCJpc1Byb2dyYW0iLCJpc0NsYXNzQm9keSIsImlzQmxvY2tTdGF0ZW1lbnQiLCJoYXNTdGFydE1lc3NhZ2UiLCJpc1N0YXJ0TWVzc2FnZSIsImNoaWxkIiwiaXNMYWJlbGVkU3RhdGVtZW50IiwibGFiZWwiLCJhbGlhc2VzIiwic2hvdWxkU3RyaXAiLCJzdHJpcCIsInNlIiwiTk9ERV9FTlYiLCJsZW5ndGgiLCJzb21lIiwicGMiLCJpbmNsdWRlcyIsInBmIiwibGV2ZWwiLCJwbCIsIm5vcm1hbGl6ZU9wdHMiLCJ0cmFjZSIsIndhcm4iLCJlcnJvciIsImRlYnVnIiwiT2JqZWN0Iiwia2V5cyIsImZvckVhY2giLCJleHByIiwidW5kZWZpbmVkIiwicHJvZHVjdGlvbiIsImxhYmVsTmFtZSIsInZhcmlhYmxlcyIsIm1ldGhvZFBhdGgiLCJpbmRleE9mIiwicHVzaCIsImVhY2giLCJzY29wZSIsImJpbmRpbmdzIiwidmFsIiwiYWxpYXMiLCJyZW1vdmUiLCJlbXB0eVN0YXRlbWVudCIsInByb3BlcnRpZXMiLCJ2YXJOYW1lIiwiSWRlbnRpZmllciIsInZhbHVlIiwidGhpc0V4cHJlc3Npb24iLCJvYmplY3RQcm9wZXJ0eSIsInJlcGxhY2VtZW50Iiwib2JqZWN0RXhwcmVzc2lvbiIsImJ1aWxkQ29kZUZyYW1lRXJyb3IiLCJFeHByZXNzaW9uU3RhdGVtZW50Iiwic3RhdGVtZW50IiwidGFyZ2V0Tm9kZSIsIm1lc3NhZ2VFbGVtZW50cyIsImNoYWluIiwiZXhwcmVzc2lvbk5vZGUiLCJjb21wYWN0IiwiaXNFbXB0eSIsImFycmF5RXhwcmVzc2lvbiIsImJvb2xlYW5MaXRlcmFsIiwiZXhwcmVzc2lvblN0YXRlbWVudCIsInJlcGxhY2VXaXRoTXVsdGlwbGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBc0NnQkEsYyxHQUFBQSxjOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRJQUMsc0IsR0FBQUEsc0I7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQThORCxVQUFVQyxLQUFWLEVBQWlCO0FBQzVCLFNBQU87QUFDSEMsSUFBQUEsT0FBTyxFQUFFO0FBQ0xDLE1BQUFBLE9BREssbUJBQ0lDLE9BREosU0FDcUIsS0FBUEMsSUFBTyxTQUFQQSxJQUFPO0FBQ3RCRCxRQUFBQSxPQUFPLENBQUNFLFFBQVIsQ0FBa0I7QUFDZEMsVUFBQUEsZ0JBRGMsNEJBQ0lDLElBREosRUFDVTtBQUNwQlIsWUFBQUEsc0JBQXNCLENBQUVDLEtBQUYsRUFBU08sSUFBVCxFQUFlSCxJQUFmLENBQXRCO0FBQ0gsV0FIYSxFQUFsQjs7O0FBTUEsWUFBSSxDQUFDRCxPQUFPLENBQUNLLGVBQWIsRUFBOEI7QUFDMUJMLFVBQUFB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QUQsQ0FBWCxHQUF3QixJQUF4QixDQUNBK0gsU0FBUyxDQUFDckksV0FBVixDQUF1QmlJLFdBQXZCLEVBQ0gsQ0F0R1UsRUFBZixFQXlHQSxJQUFJN0ksSUFBSSxDQUFDSyxJQUFULEVBQWUsQ0FDWCxJQUFJTCxJQUFJLENBQUNpQixHQUFMLENBQVUsTUFBVixFQUFrQjZFLGdCQUFsQixFQUFKLEVBQTJDLENBQ3ZDOUYsSUFBSSxDQUFDMkosbUJBQUwsQ0FBMEIzSixJQUFJLENBQUNpQixHQUFMLENBQVUsTUFBVixFQUFrQlosSUFBbEIsQ0FBdUJDLElBQWpELEVBQ0gsQ0FGRCxNQUVPLENBQ0hOLElBQUksQ0FBQ1ksV0FBTCxDQUFrQlosSUFBSSxDQUFDaUIsR0FBTCxDQUFVLE1BQVYsRUFBa0JaLElBQXBDLEVBQ0gsQ0FDSixDQUNKLENBQ0QsSUFBTUYsWUFBWSxHQUFHYSxRQUFRLG14Q0FBN0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnNwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgXyBmcm9tICd1bmRlcnNjb3JlJztcbmltcG9ydCB0ZW1wbGF0ZSBmcm9tIFwiQGJhYmVsL3RlbXBsYXRlXCI7XG5pbXBvcnQge2dldH0gZnJvbSAnbG9kYXNoJztcblxuY29uc3QgJGhhbmRsZWQgPSBTeW1ib2wgKCdoYW5kbGVkJyk7XG5jb25zdCAkbm9ybWFsaXplZCA9IFN5bWJvbCAoJ25vcm1hbGl6ZWQnKTtcblxuY29uc3QgUFJFU0VSVkVfQ09OVEVYVFMgPSBub3JtYWxpemVFbnYgKHByb2Nlc3MuZW52LlRSQUNFX0NPTlRFWFQpO1xuY29uc3QgUFJFU0VSVkVfRklMRVMgPSBub3JtYWxpemVFbnYgKHByb2Nlc3MuZW52LlRSQUNFX0ZJTEUpO1xuY29uc3QgUFJFU0VSVkVfTEVWRUxTID0gbm9ybWFsaXplRW52IChwcm9jZXNzLmVudi5UUkFDRV9MRVZFTCk7XG5cbi8qKlxuICogTm9ybWFsaXplIGFuIGVudmlyb25tZW50IHZhcmlhYmxlLCB1c2VkIHRvIG92ZXJyaWRlIHBsdWdpbiBvcHRpb25zLlxuICovXG5mdW5jdGlvbiBub3JtYWxpemVFbnYgKGlucHV0KXtcbiAgICBpZiAoIWlucHV0KSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgcmV0dXJuIGlucHV0LnNwbGl0ICgnLCcpXG4gICAgLm1hcCAoY29udGV4dCA9PiBjb250ZXh0LnRvTG93ZXJDYXNlICgpLnRyaW0gKCkpXG4gICAgLmZpbHRlciAoaWQgPT4gaWQpO1xufVxuXG4vKipcbiAqIExpa2UgYHRlbXBsYXRlKClgIGJ1dCByZXR1cm5zIGFuIGV4cHJlc3Npb24sIG5vdCBhbiBleHByZXNzaW9uIHN0YXRlbWVudC5cbiAqL1xuZnVuY3Rpb24gZXhwcmVzc2lvbiAoaW5wdXQsIHRlbXBsYXRlKSB7XG4gICAgY29uc3QgZm4gPSB0ZW1wbGF0ZSAoaW5wdXQpO1xuICAgIHJldHVybiBmdW5jdGlvbiAoaWRzKSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBmbiAoaWRzKTtcbiAgICAgICAgcmV0dXJuIG5vZGUuZXhwcmVzc2lvbiA/IG5vZGUuZXhwcmVzc2lvbiA6IG5vZGU7XG4gICAgfTtcbn1cblxuLyoqXG4gKiBUaGUgZGVmYXVsdCBsb2coKSBmdW5jdGlvbi5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldExvZ0Z1bmN0aW9uICh7dHlwZXM6IHQsIHRlbXBsYXRlfSwgbG9nTGV2ZWwpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gbG9nIChtZXNzYWdlLCBtZXRhZGF0YSkge1xuICAgICAgICBsZXQgbWVzc2FnZUV4cHJlc3Npb24gPSBtZXNzYWdlLm1lc3NhZ2VFeHByZXNzaW9uO1xuICAgICAgICBsZXQgcHJlZml4ID0gYCR7bWV0YWRhdGEuY29udGV4dH06YDtcbiAgICAgICAgaWYgKG1ldGFkYXRhLmluZGVudCkge1xuICAgICAgICAgICAgcHJlZml4ICs9IChuZXcgQXJyYXkgKG1ldGFkYXRhLmluZGVudCArIDEpKS5qb2luICgnICAnKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgaWYgKHQuaXNTZXF1ZW5jZUV4cHJlc3Npb24gKG1lc3NhZ2UuY29udGVudCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0LmNhbGxFeHByZXNzaW9uIChcbiAgICAgICAgICAgICAgICB0Lm1lbWJlckV4cHJlc3Npb24gKFxuICAgICAgICAgICAgICAgICAgICB0LmlkZW50aWZpZXIgKCdjb25zb2xlJyksXG4gICAgICAgICAgICAgICAgICAgIHQuaWRlbnRpZmllciAobG9nTGV2ZWwpXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICBbdC5zdHJpbmdMaXRlcmFsIChwcmVmaXgpXS5jb25jYXQgKG1lc3NhZ2UuY29udGVudC5leHByZXNzaW9ucylcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBMSU5FID0gbWV0YWRhdGEucGF0aC5ub2RlLmxvYy5zdGFydC5saW5lO1xuICAgICAgICAgICAgcmV0dXJuIGV4cHJlc3Npb24gKGBWTV9SVU5ORVJfVFJBQ0UuYXBwbHkoe2xpbmU6TElORX0sW0xPR0xFVkVMLCBQUkVGSVgsIE1FU1NBR0UsICBEQVRBXSlgLCB0ZW1wbGF0ZSkgKHtcbiAgICAgICAgICAgICAgICBMT0dMRVZFTDogdC5zdHJpbmdMaXRlcmFsIChsb2dMZXZlbCksXG4gICAgICAgICAgICAgICAgUFJFRklYOiB0LnN0cmluZ0xpdGVyYWwgKHByZWZpeCksXG4gICAgICAgICAgICAgICAgREFUQTogbWVzc2FnZS5jb250ZW50LFxuICAgICAgICAgICAgICAgIExJTkU6dC5udW1lcmljTGl0ZXJhbChMSU5FKSxcbiAgICAgICAgICAgICAgICBWTV9SVU5ORVJfVFJBQ0U6dC5pZGVudGlmaWVyICgnVk1fUlVOTkVSX1RSQUNFJyksXG4gICAgICAgICAgICAgICAgTUVTU0FHRTptZXNzYWdlRXhwcmVzc2lvblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlUHJlZml4IChkaXJuYW1lLCBiYXNlbmFtZSkge1xuICAgIGlmIChiYXNlbmFtZSAhPT0gJ2luZGV4Jykge1xuICAgICAgICByZXR1cm4gYmFzZW5hbWU7XG4gICAgfVxuICAgIGJhc2VuYW1lID0gZnNwYXRoLmJhc2VuYW1lIChkaXJuYW1lKTtcbiAgICBpZiAoYmFzZW5hbWUgIT09ICdzcmMnICYmIGJhc2VuYW1lICE9PSAnbGliJykge1xuICAgICAgICByZXR1cm4gYmFzZW5hbWU7XG4gICAgfVxuICAgIHJldHVybiBmc3BhdGguYmFzZW5hbWUgKGZzcGF0aC5kaXJuYW1lIChkaXJuYW1lKSk7XG59XG5cbi8qKlxuICogQ29sbGVjdCB0aGUgbWV0YWRhdGEgZm9yIGEgZ2l2ZW4gbm9kZSBwYXRoLCB3aGljaCB3aWxsIGJlXG4gKiBtYWRlIGF2YWlsYWJsZSB0byBsb2dnaW5nIGZ1bmN0aW9ucy5cbiAqL1xuZnVuY3Rpb24gY29sbGVjdE1ldGFkYXRhIChwYXRoLCBvcHRzKSB7XG4gICAgY29uc3QgZmlsZW5hbWUgPSBmc3BhdGgucmVzb2x2ZSAocHJvY2Vzcy5jd2QgKCksIHBhdGguaHViLmZpbGUub3B0cy5maWxlbmFtZSk7XG4gICAgY29uc3QgZGlybmFtZSA9IGZzcGF0aC5kaXJuYW1lIChmaWxlbmFtZSk7XG4gICAgY29uc3QgZXh0bmFtZSA9IGZzcGF0aC5leHRuYW1lIChmaWxlbmFtZSk7XG4gICAgY29uc3QgYmFzZW5hbWUgPSBmc3BhdGguYmFzZW5hbWUgKGZpbGVuYW1lLCBleHRuYW1lKTtcbiAgICBjb25zdCBwcmVmaXggPSBnZW5lcmF0ZVByZWZpeCAoZGlybmFtZSwgYmFzZW5hbWUpO1xuICAgIGNvbnN0IG5hbWVzID0gW107XG4gICAgbGV0IGluZGVudCA9IDA7XG4gICAgbGV0IHBhcmVudDtcblxuICAgIGNvbnN0IHBhcmVudE5hbWUgPSBwYXRoLmdldEFuY2VzdHJ5ICgpLnNsaWNlICgxKS5yZWR1Y2UgKChwYXJ0cywgaXRlbSkgPT4ge1xuICAgICAgICBpZiAoaXRlbS5pc0NsYXNzTWV0aG9kICgpKSB7XG4gICAgICAgICAgICBpZiAoIXBhcmVudCkge1xuICAgICAgICAgICAgICAgIHBhcmVudCA9IGl0ZW07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJ0cy51bnNoaWZ0IChpdGVtLm5vZGUua2V5LnR5cGUgPT09ICdJZGVudGlmaWVyJyA/IGl0ZW0ubm9kZS5rZXkubmFtZSA6ICdbY29tcHV0ZWQgbWV0aG9kXScpO1xuICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uaXNDbGFzc0RlY2xhcmF0aW9uICgpKSB7XG4gICAgICAgICAgICBpZiAoIXBhcmVudCkge1xuICAgICAgICAgICAgICAgIHBhcmVudCA9IGl0ZW07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJ0cy51bnNoaWZ0IChpdGVtLm5vZGUuaWQgPyBpdGVtLm5vZGUuaWQubmFtZSA6IGBbYW5vbnltb3VzIGNsYXNzQCR7aXRlbS5ub2RlLmxvYy5zdGFydC5saW5lfV1gKTtcbiAgICAgICAgfSBlbHNlIGlmIChpdGVtLmlzRnVuY3Rpb24gKCkpIHtcbiAgICAgICAgICAgIGlmICghcGFyZW50KSB7XG4gICAgICAgICAgICAgICAgcGFyZW50ID0gaXRlbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBhcnRzLnVuc2hpZnQgKChpdGVtLm5vZGUuaWQgJiYgaXRlbS5ub2RlLmlkLm5hbWUpIHx8IGBbYW5vbnltb3VzQCR7aXRlbS5ub2RlLmxvYy5zdGFydC5saW5lfV1gKTtcbiAgICAgICAgfSBlbHNlIGlmIChpdGVtLmlzUHJvZ3JhbSAoKSkge1xuICAgICAgICAgICAgaWYgKCFwYXJlbnQpIHtcbiAgICAgICAgICAgICAgICBwYXJlbnQgPSBpdGVtO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKCFwYXJlbnQgJiYgIWl0ZW0uaXNDbGFzc0JvZHkgKCkgJiYgIWl0ZW0uaXNCbG9ja1N0YXRlbWVudCAoKSkge1xuICAgICAgICAgICAgaW5kZW50Kys7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhcnRzO1xuICAgIH0sIFtdKS5qb2luICgnOicpO1xuXG4gICAgbGV0IGhhc1N0YXJ0TWVzc2FnZSA9IGZhbHNlO1xuICAgIGxldCBpc1N0YXJ0TWVzc2FnZSA9IGZhbHNlO1xuICAgIGlmIChwYXJlbnQgJiYgIXBhcmVudC5pc1Byb2dyYW0gKCkpIHtcbiAgICAgICAgZm9yIChsZXQgY2hpbGQgb2YgcGFyZW50LmdldCAoJ2JvZHknKS5nZXQgKCdib2R5JykpIHtcbiAgICAgICAgICAgIGlmIChjaGlsZC5ub2RlWyRoYW5kbGVkXSkge1xuICAgICAgICAgICAgICAgIGhhc1N0YXJ0TWVzc2FnZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWNoaWxkLmlzTGFiZWxlZFN0YXRlbWVudCAoKSkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbGFiZWwgPSBjaGlsZC5nZXQgKCdsYWJlbCcpO1xuICAgICAgICAgICAgaWYgKG9wdHMuYWxpYXNlc1tsYWJlbC5ub2RlLm5hbWVdKSB7XG4gICAgICAgICAgICAgICAgaGFzU3RhcnRNZXNzYWdlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGQubm9kZSA9PT0gcGF0aC5ub2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzU3RhcnRNZXNzYWdlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBjb250ZXh0ID0gYCR7cHJlZml4fToke3BhcmVudE5hbWV9YDtcbiAgICByZXR1cm4ge2luZGVudCwgcHJlZml4LCBwYXJlbnROYW1lLCBjb250ZXh0LCBoYXNTdGFydE1lc3NhZ2UsIGlzU3RhcnRNZXNzYWdlLCBmaWxlbmFtZSwgZGlybmFtZSwgYmFzZW5hbWUsIGV4dG5hbWUsIHBhdGh9O1xufVxuXG4vKipcbiAqIERldGVybWluZSB3aGV0aGVyIHRoZSBnaXZlbiBsb2dnaW5nIHN0YXRlbWVudCBzaG91bGQgYmUgc3RyaXBwZWQuXG4gKi9cbmZ1bmN0aW9uIHNob3VsZFN0cmlwIChuYW1lLCBtZXRhZGF0YSwge3N0cmlwfSkge1xuICAgIHN3aXRjaCAodHlwZW9mIHN0cmlwKSB7XG4gICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgaWYgKCFzdHJpcCkgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgLy8gc3RyaXAgPT09IHRydWVcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgY29uc3Qgc2UgPSBzdHJpcFtuYW1lXTtcbiAgICAgICAgICAgIGlmICghc2UgfHwgKHR5cGVvZiBzZSA9PT0gJ29iamVjdCcgJiYgIXNlW3Byb2Nlc3MuZW52Lk5PREVfRU5WXSkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIC8vIHN0cmlwW25hbWVdID09PSB0cnVlIHx8IHN0cmlwW25hbWVdW2Vudl0gPT09IHRydWVcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoUFJFU0VSVkVfQ09OVEVYVFMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBtZXRhZGF0YS5jb250ZXh0LnRvTG93ZXJDYXNlICgpO1xuICAgICAgICBpZiAoUFJFU0VSVkVfQ09OVEVYVFMuc29tZSAocGMgPT4gY29udGV4dC5pbmNsdWRlcyAocGMpKSkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoUFJFU0VSVkVfRklMRVMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IGZpbGVuYW1lID0gbWV0YWRhdGEuZmlsZW5hbWUudG9Mb3dlckNhc2UgKCk7XG4gICAgICAgIGlmIChQUkVTRVJWRV9GSUxFUy5zb21lIChwZiA9PiBmaWxlbmFtZS5pbmNsdWRlcyAocGYpKSkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoUFJFU0VSVkVfTEVWRUxTLmxlbmd0aCkge1xuICAgICAgICBjb25zdCBsZXZlbCA9IG5hbWUudG9Mb3dlckNhc2UgKCk7XG4gICAgICAgIGlmIChQUkVTRVJWRV9MRVZFTFMuc29tZSAocGwgPT4gbGV2ZWwgPT09IHBsKSkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUxhYmVsZWRTdGF0ZW1lbnQgKGJhYmVsLCBwYXRoLCBvcHRzKSB7XG4gICAgY29uc3QgdCA9IGJhYmVsLnR5cGVzO1xuICAgIGNvbnN0IGxhYmVsID0gcGF0aC5nZXQgKCdsYWJlbCcpO1xuICAgIG9wdHMgPSAoZnVuY3Rpb24gbm9ybWFsaXplT3B0cyAoYmFiZWwsIG9wdHMpIHtcbiAgICAgICAgaWYgKG9wdHNbJG5vcm1hbGl6ZWRdKSB7XG4gICAgICAgICAgICByZXR1cm4gb3B0cztcbiAgICAgICAgfVxuICAgICAgICBpZiAoIW9wdHMuYWxpYXNlcykge1xuICAgICAgICAgICAgb3B0cy5hbGlhc2VzID0ge1xuICAgICAgICAgICAgICAgIGxvZzogZ2V0TG9nRnVuY3Rpb24gKGJhYmVsLCAnbG9nJyksXG4gICAgICAgICAgICAgICAgdHJhY2U6IGdldExvZ0Z1bmN0aW9uIChiYWJlbCwgJ3RyYWNlJyksXG4gICAgICAgICAgICAgICAgd2FybjogZ2V0TG9nRnVuY3Rpb24gKGJhYmVsLCAnd2FybicpLFxuICAgICAgICAgICAgICAgIGVycm9yOmdldExvZ0Z1bmN0aW9uKGJhYmVsLCdlcnJvcicpLFxuICAgICAgICAgICAgICAgIGRlYnVnOmdldExvZ0Z1bmN0aW9uKGJhYmVsLCdkZWJ1ZycpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMgKG9wdHMuYWxpYXNlcykuZm9yRWFjaCAoa2V5ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9wdHMuYWxpYXNlc1trZXldID09PSAnc3RyaW5nJyAmJiBvcHRzLmFsaWFzZXNba2V5XSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBleHByID0gZXhwcmVzc2lvbiAob3B0cy5hbGlhc2VzW2tleV0sIGJhYmVsLnRlbXBsYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgb3B0cy5hbGlhc2VzW2tleV0gPSAobWVzc2FnZSkgPT4gZXhwciAobWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdHMuc3RyaXAgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgb3B0cy5zdHJpcCA9IHtcbiAgICAgICAgICAgICAgICBsb2c6IHtwcm9kdWN0aW9uOiB0cnVlfSxcbiAgICAgICAgICAgICAgICB0cmFjZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgd2Fybjoge3Byb2R1Y3Rpb246IHRydWV9XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIG9wdHNbJG5vcm1hbGl6ZWRdID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIG9wdHM7XG4gICAgfSkoYmFiZWwsIG9wdHMpO1xuXG4gICAgY29uc3QgbGFiZWxOYW1lID0gbGFiZWwubm9kZS5uYW1lO1xuICAgIGNvbnN0IHZhcmlhYmxlcyA9ICBbXTtcblxuICAgIGNvbnN0IG1ldGhvZFBhdGggPSBnZXQocGF0aCwncGFyZW50UGF0aC5wYXJlbnRQYXRoJyxudWxsKTtcbiAgICBpZihtZXRob2RQYXRoICYmWydDbGFzc01ldGhvZCcsJ09iamVjdE1ldGhvZCddLmluZGV4T2YobWV0aG9kUGF0aC50eXBlKT4tMSYmIW1ldGhvZFBhdGgubm9kZS5zdGF0aWMpe1xuICAgICAgICB2YXJpYWJsZXMucHVzaCgndGhpcycpO1xuICAgIH1cbiAgICBfLmVhY2goIHBhdGguc2NvcGUuYmluZGluZ3MgLCAodmFsLGtleSk9PntcbiAgICAgICAgaWYodmFyaWFibGVzLmluZGV4T2Yoa2V5KT09LTEpXG4gICAgICAgICAgICB2YXJpYWJsZXMucHVzaChrZXkpO1xuICAgIH0pO1xuXG5cbiAgICBjb25zdCBhbGlhcyA9IG9wdHMuYWxpYXNlc1tsYWJlbE5hbWVdXG4gICAgaWYgKCFhbGlhcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG1ldGFkYXRhID0gY29sbGVjdE1ldGFkYXRhIChwYXRoLCBvcHRzKTtcbiAgICBpZiAoc2hvdWxkU3RyaXAgKGxhYmVsLm5vZGUubmFtZSwgbWV0YWRhdGEsIG9wdHMpKSB7XG4gICAgICAgIHBhdGgucmVtb3ZlICgpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcGF0aC50cmF2ZXJzZSAoe1xuICAgICAgICBcIkVtcHR5U3RhdGVtZW50XCIgKGVtcHR5U3RhdGVtZW50KXtcbiAgICAgICAgICAgIGxldCBwcm9wZXJ0aWVzID0gXy5tYXAgKHZhcmlhYmxlcywgKHZhck5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQga2V5ID0gdC5JZGVudGlmaWVyICh2YXJOYW1lKTtcbiAgICAgICAgICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgICAgICAgICAgaWYodmFyTmFtZSE9J3RoaXMnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdC5JZGVudGlmaWVyICh2YXJOYW1lKTtcbiAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0LnRoaXNFeHByZXNzaW9uKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiB0Lm9iamVjdFByb3BlcnR5IChrZXksIHZhbHVlLCBmYWxzZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGxldCByZXBsYWNlbWVudCA9IHQub2JqZWN0RXhwcmVzc2lvbiAocHJvcGVydGllcyk7XG4gICAgICAgICAgICByZXBsYWNlbWVudFskaGFuZGxlZF0gPSB0cnVlO1xuICAgICAgICAgICAgZW1wdHlTdGF0ZW1lbnQucmVwbGFjZVdpdGggKHJlcGxhY2VtZW50KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcIlRlbXBsYXRlTGl0ZXJhbHxTdHJpbmdMaXRlcmFsXCIoaXRlbSl7XG5cbiAgICAgICAgfSwqL1xuICAgICAgICBcIlZhcmlhYmxlRGVjbGFyYXRpb258RnVuY3Rpb258QXNzaWdubWVudEV4cHJlc3Npb258VXBkYXRlRXhwcmVzc2lvbnxZaWVsZEV4cHJlc3Npb258UmV0dXJuU3RhdGVtZW50XCIgKGl0ZW0pIHtcbiAgICAgICAgICAgIHRocm93IHBhdGguYnVpbGRDb2RlRnJhbWVFcnJvciAoYExvZ2dpbmcgc3RhdGVtZW50cyBjYW5ub3QgaGF2ZSBzaWRlIGVmZmVjdHMuICR7aXRlbS50eXBlfWApO1xuICAgICAgICB9LFxuICAgICAgICBFeHByZXNzaW9uU3RhdGVtZW50IChzdGF0ZW1lbnQpIHtcbiAgICAgICAgICAgIGlmIChzdGF0ZW1lbnQubm9kZVskaGFuZGxlZF0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgdGFyZ2V0Tm9kZSA9IHN0YXRlbWVudC5nZXQgKCdleHByZXNzaW9uJykubm9kZTtcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2VFbGVtZW50cyA9IFtdO1xuICAgICAgICAgICAgaWYodGFyZ2V0Tm9kZS50eXBlPT09J1NlcXVlbmNlRXhwcmVzc2lvbicpe1xuICAgICAgICAgICAgICAgIGxldCBwcm9wZXJ0aWVzID0gXy5jaGFpbih0YXJnZXROb2RlLmV4cHJlc3Npb25zKS5tYXAoKGV4cHJlc3Npb25Ob2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmKFsnSWRlbnRpZmllcicsJ1RoaXNFeHByZXNzaW9uJ10uaW5kZXhPZihleHByZXNzaW9uTm9kZS50eXBlKT4tMSl7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmFyTmFtZSA9IGV4cHJlc3Npb25Ob2RlLnR5cGU9PT0nSWRlbnRpZmllcic/ZXhwcmVzc2lvbk5vZGUubmFtZTondGhpcyc7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQga2V5ID0gdC5JZGVudGlmaWVyICh2YXJOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGV4cHJlc3Npb25Ob2RlLnR5cGU9PT0nSWRlbnRpZmllcicpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHQuSWRlbnRpZmllciAodmFyTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHQudGhpc0V4cHJlc3Npb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0Lm9iamVjdFByb3BlcnR5IChrZXksIHZhbHVlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmKFsnU3RyaW5nTGl0ZXJhbCcsJ1RlbXBsYXRlTGl0ZXJhbCddLmluZGV4T2YoZXhwcmVzc2lvbk5vZGUudHlwZSk+LTEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZUVsZW1lbnRzLnB1c2goZXhwcmVzc2lvbk5vZGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkuY29tcGFjdCgpLnZhbHVlKCk7XG4gICAgICAgICAgICAgICAgaWYoIF8uaXNFbXB0eShwcm9wZXJ0aWVzKSAmJiAhXy5pc0VtcHR5KG1lc3NhZ2VFbGVtZW50cykgKXtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHByb3BlcnRpZXMgPSBfLm1hcCAodmFyaWFibGVzLCAodmFyTmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGtleSA9IHQuSWRlbnRpZmllciAodmFyTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih2YXJOYW1lIT0ndGhpcycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHQuSWRlbnRpZmllciAodmFyTmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHQudGhpc0V4cHJlc3Npb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0Lm9iamVjdFByb3BlcnR5IChrZXksIHZhbHVlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXROb2RlID0gdC5vYmplY3RFeHByZXNzaW9uIChwcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICB0YXJnZXROb2RlID0gdC5vYmplY3RFeHByZXNzaW9uIChwcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgIH1lbHNlIGlmKFsnVGVtcGxhdGVMaXRlcmFsJywnU3RyaW5nTGl0ZXJhbCddLmluZGV4T2YodGFyZ2V0Tm9kZS50eXBlKT4tMSl7XG4gICAgICAgICAgICAgICAgbWVzc2FnZUVsZW1lbnRzLnB1c2godGFyZ2V0Tm9kZSk7XG5cbiAgICAgICAgICAgICAgICBsZXQgcHJvcGVydGllcyA9IF8ubWFwICh2YXJpYWJsZXMsICh2YXJOYW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBrZXkgPSB0LklkZW50aWZpZXIgKHZhck5hbWUpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGlmKHZhck5hbWUhPSd0aGlzJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB0LklkZW50aWZpZXIgKHZhck5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdC50aGlzRXhwcmVzc2lvbigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0Lm9iamVjdFByb3BlcnR5IChrZXksIHZhbHVlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGFyZ2V0Tm9kZSA9IHQub2JqZWN0RXhwcmVzc2lvbiAocHJvcGVydGllcyk7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgY29uc3QgbWVzc2FnZUV4cHJlc3Npb24gPSB0LmNhbGxFeHByZXNzaW9uKFxuICAgICAgICAgICAgICAgIHQubWVtYmVyRXhwcmVzc2lvbihcbiAgICAgICAgICAgICAgICAgICAgdC5hcnJheUV4cHJlc3Npb24obWVzc2FnZUVsZW1lbnRzKSwvL29iamVjdFxuICAgICAgICAgICAgICAgICAgICB0LmlkZW50aWZpZXIoJ2pvaW4nKSwvL3Byb3BlcnR5XG4gICAgICAgICAgICAgICAgICAgIGZhbHNlLy9jb21wdXRlZFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAsIFtcbiAgICAgICAgICAgICAgICAgICAgdC5zdHJpbmdMaXRlcmFsKCcgJylcbiAgICAgICAgICAgICAgICBdKTtcblxuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlRXhwcmVzc2lvbixcbiAgICAgICAgICAgICAgICBwcmVmaXg6IHQuc3RyaW5nTGl0ZXJhbCAobWV0YWRhdGEucHJlZml4KSxcbiAgICAgICAgICAgICAgICBjb250ZW50OiB0YXJnZXROb2RlLFxuICAgICAgICAgICAgICAgIGhhc1N0YXJ0TWVzc2FnZTogdC5ib29sZWFuTGl0ZXJhbCAobWV0YWRhdGEuaGFzU3RhcnRNZXNzYWdlKSxcbiAgICAgICAgICAgICAgICBpc1N0YXJ0TWVzc2FnZTogdC5ib29sZWFuTGl0ZXJhbCAobWV0YWRhdGEuaXNTdGFydE1lc3NhZ2UpLFxuICAgICAgICAgICAgICAgIGluZGVudDogdC5udW1lcmljTGl0ZXJhbCAobWV0YWRhdGEuaW5kZW50KSxcbiAgICAgICAgICAgICAgICBwYXJlbnROYW1lOiB0LnN0cmluZ0xpdGVyYWwgKG1ldGFkYXRhLnBhcmVudE5hbWUpLFxuICAgICAgICAgICAgICAgIGZpbGVuYW1lOiB0LnN0cmluZ0xpdGVyYWwgKG1ldGFkYXRhLmZpbGVuYW1lKSxcbiAgICAgICAgICAgICAgICBkaXJuYW1lOiB0LnN0cmluZ0xpdGVyYWwgKG1ldGFkYXRhLmRpcm5hbWUpLFxuICAgICAgICAgICAgICAgIGJhc2VuYW1lOiB0LnN0cmluZ0xpdGVyYWwgKG1ldGFkYXRhLmJhc2VuYW1lKSxcbiAgICAgICAgICAgICAgICBleHRuYW1lOiB0LnN0cmluZ0xpdGVyYWwgKG1ldGFkYXRhLmV4dG5hbWUpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgcmVwbGFjZW1lbnQgPSB0LmV4cHJlc3Npb25TdGF0ZW1lbnQgKGFsaWFzIChtZXNzYWdlLCBtZXRhZGF0YSkpO1xuICAgICAgICAgICAgcmVwbGFjZW1lbnRbJGhhbmRsZWRdID0gdHJ1ZTtcbiAgICAgICAgICAgIHN0YXRlbWVudC5yZXBsYWNlV2l0aCAocmVwbGFjZW1lbnQpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAocGF0aC5ub2RlKSB7XG4gICAgICAgIGlmIChwYXRoLmdldCAoJ2JvZHknKS5pc0Jsb2NrU3RhdGVtZW50ICgpKSB7XG4gICAgICAgICAgICBwYXRoLnJlcGxhY2VXaXRoTXVsdGlwbGUgKHBhdGguZ2V0ICgnYm9keScpLm5vZGUuYm9keSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwYXRoLnJlcGxhY2VXaXRoIChwYXRoLmdldCAoJ2JvZHknKS5ub2RlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmNvbnN0IHdyYXBWbVJ1bm5lciA9IHRlbXBsYXRlIChgXG52YXIgVk1fUlVOTkVSX1JVTl9JRCA9ICcnO1xuXG5mdW5jdGlvbiBnZW5lcmF0ZVVpZCgpe1xuICAgIHZhciB1PScnLGk9MDsgdmFyIGZvdXIgPSA0O1xuICAgIHZhciBwYXR0ZXJuID0gJ3h4eHh4eHh4LXh4eHgtJytmb3VyKyd4eHgteXh4eC14eHh4eHh4eHh4eHgnO1xuICAgIHdoaWxlKGkrKzwzNikge1xuICAgICAgICB2YXIgYz1wYXR0ZXJuW2ktMV0sXG4gICAgICAgIHI9TWF0aC5yYW5kb20oKSoxNnwwLHY9Yz09J3gnP3I6KHImMHgzfDB4OCk7XG4gICAgICAgIHUrPShjPT0nLSd8fGM9PWZvdXIpP2M6di50b1N0cmluZygxNilcbiAgICB9XG4gICAgcmV0dXJuIHU7XG59IFxuXG5pZiggdHlwZW9mKHZtMk9wdGlvbnMpPT09J3VuZGVmaW5lZCcgKXtcbiAgdm0yT3B0aW9ucyA9IHt9O1xufVxudmFyIFZNX1JVTk5FUl9IQVNIID0gdm0yT3B0aW9ucy5WTV9SVU5ORVJfSEFTSDtcblxudmFyIGN1c3RvbU9wdGlvbnMgPSB2bTJPcHRpb25zLmN1c3RvbU9wdGlvbnMgfHwge307XG52YXIgdHJhY2VPcHRpb25zID0gY3VzdG9tT3B0aW9ucy50cmFjZXx8e307XG5cbnZhciBWTV9SVU5ORVJfVFJBQ0UgPSBmdW5jdGlvbihsb2dMZXZlbCxwcmVmaXgsbWVzc2FnZSxkYXRhKXtcbiAgICB2YXIgYWxpYXMgPSB0cmFjZU9wdGlvbnMgJiYgdHJhY2VPcHRpb25zLmFsaWFzZXMgJiYgdHJhY2VPcHRpb25zLmFsaWFzZXNbbG9nTGV2ZWxdIDtcbiAgICB2YXIgZXhwcmVzc2lvbiA9ICh0eXBlb2Ygdm0yT3B0aW9ucyApIT09J3VuZGVmaW5lZCcgPyB2bTJPcHRpb25zLmV4cHJlc3Npb24gOiBudWxsO1xuICAgIHZhciBtZXNzYWdlT2JqID0ge1xuICAgICAgICBmcmFtZTp2bUNvZGVGcmFtZShleHByZXNzaW9uLHRoaXMubGluZSksXG4gICAgICAgIHByZWZpeDpwcmVmaXgsXG4gICAgICAgIG1lc3NhZ2U6bWVzc2FnZSxcbiAgICAgICAgbG9nTGV2ZWw6bG9nTGV2ZWwsXG4gICAgICAgIGRhdGE6ZGF0YSxcbiAgICAgICAgbGluZTp0aGlzLmxpbmUsXG4gICAgICAgIGRhdGU6bmV3IERhdGUoKVxuICAgIH1cbiAgICBpZiggYWxpYXMgKXtcbiAgICAgICAgdHJ5e1xuICAgICAgICAgICAgcmV0dXJuIGFsaWFzLmFwcGx5KHRoaXMsW21lc3NhZ2VPYmpdKTtcbiAgICAgICAgfWNhdGNoKGUpe1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cblxuXG5yZXR1cm4gKGZ1bmN0aW9uIHZtUnVubmVyV3JhcHBlcigpIHtcbiAgICBWTV9SVU5ORVJfUlVOX0lEID0gZ2VuZXJhdGVVaWQoKTtcbiAgICBcbiAgICBCT0RZO1xufSkuYXBwbHkodGhpcyk7XG5gKTtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKGJhYmVsKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdmlzaXRvcjoge1xuICAgICAgICAgICAgUHJvZ3JhbSAocHJvZ3JhbSwge29wdHN9KSB7XG4gICAgICAgICAgICAgICAgcHJvZ3JhbS50cmF2ZXJzZSAoe1xuICAgICAgICAgICAgICAgICAgICBMYWJlbGVkU3RhdGVtZW50IChwYXRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVMYWJlbGVkU3RhdGVtZW50IChiYWJlbCwgcGF0aCwgb3B0cyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmICghcHJvZ3JhbS52bVJ1bm5lcldyYXBwZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvZ3JhbS52bVJ1bm5lcldyYXBwZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgd3JhcHBlZCA9IHdyYXBWbVJ1bm5lciAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgQk9EWTogcHJvZ3JhbS5ub2RlLmJvZHksXG4gICAgICAgICAgICAgICAgICAgICAgICBWTV9SVU5ORVJfUlVOX0lEOmJhYmVsLnR5cGVzLmlkZW50aWZpZXIgKCdWTV9SVU5ORVJfUlVOX0lEJyksXG4gICAgICAgICAgICAgICAgICAgICAgICBWTV9SVU5ORVJfSEFTSDpiYWJlbC50eXBlcy5pZGVudGlmaWVyICgnVk1fUlVOTkVSX0hBU0gnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFZNX1JVTk5FUl9UUkFDRTpiYWJlbC50eXBlcy5pZGVudGlmaWVyICgnVk1fUlVOTkVSX1RSQUNFJyksXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHByb2dyYW0ucmVwbGFjZVdpdGggKFxuICAgICAgICAgICAgICAgICAgICAgICAgYmFiZWwudHlwZXMucHJvZ3JhbSAod3JhcHBlZClcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHJvZ3JhbS5ub2RlLmRpcmVjdGl2ZXMgPSBbXTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbn1cbiJdfQ==